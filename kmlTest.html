<html>
<head>
<!-- May need jquery to ease development - e.g. loading json doc -->
<script type="text/javascript" src="jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.min.js"></script>


<script>
      var map;
      var pathUrl = 'https://raw.github.com/pbrewer/kml-sample/master/';
      var ctaLayer;

    
      
      function initialize() {
        	var point = new google.maps.LatLng(51.5958, -0.11862);
        	var mapOptions = {
        	  zoom: 11,
    	      center: point
	        }

	        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

        	ctaLayer = new google.maps.KmlLayer();
    	    
		    ctaLayer.setMap(map);

      		$("#mapCodes").change(function(){
             ctaLayer.setMap(null); 
             ctaLayer.setUrl(pathUrl + $("#mapCodes option:selected").val());
             ctaLayer.setMap(map); 		
        	});
        	
      	}

      	function setDefaultMap(kmlFile) {
        	ctaLayer.setUrl(pathUrl + kmlFile);
 		}

    	
     	$.getJSON( "ajax/map_meta_data.json", function(data) {
            $.each(data.maps, function(key, value) {
  			  	 if (key == 0) {
  			  		  setDefaultMap(value.kmlUrl);
  				 }
                 $("#mapCodes").append('<option value="' + value.kmlUrl + '">' + value.mapCode + ' - ' + value.mapName + '</option>');
            });
    	}); 

/*
      function popup(_point) {
          _point.popup = new InfoBox({
              content:            _point.content,
              pane:               'floatPane',
              closeBoxURL:        '',
              alignBottom:        1
          });

          _point.popup.open(_point.marker.map, _point.marker); */

     google.maps.event.addDomListener(window, 'load', initialize);

/*      google.maps.event.addListener(_point.popup, 'domready', function() {
    	//Have to put this within the domready or else it can't find the div element (it's null until the InfoBox is opened)

    	    $(_point.popup.div_).hover(
    	        function() {
    	            //This is called when the mouse enters the element
    	        },
    	        function() {
    	            //This is called when the mouse leaves the element
    	            _point.popup.close();
    	        }
    	    );
    	}); */

/*      function createMarker(point,html) {
         var marker = new GMarker(point);
         GEvent.addListener(marker, "click", function() {
           marker.openInfoWindowHtml(html);
         });

         // The new marker "mouseover" listener        
         google.maps.event.addListener(marker,"mouseover", function() {
        	 infowindow.open(map, marker);
         });        
         
         return marker;
       } */
	 
  
    </script>

<!--  	<script type="text/javascript">
 	
  	$.ajaxSetup({
    	contentType : 'application/json',
    	processData : false
  	});
  	$.ajaxPrefilter( function( options, originalOptions, jqXHR ) {
    	if (options.data && options.type != 'GET'){
      		options.data=JSON.stringify(options.data);
    	}
  	});
	</script>

	<script type="text/javascript">
	var url = "https://raw.github.com/pbrewer/kml-sample/master/ajax/map_meta_data.json" ;
	var result = {success: false} ;
	var request = {
    	type: "GET",
    	async: false,
    	contentType: "application/json",
    	dataType: "json",
    	url: url,
    	success: function(data, textStatus, jqXHR) {
      	result.success = true ;
      	result.message = textStatus ;
      	result.data = data ;
      	result.jqXHR = jqXHR ;
    },
    error: function(jqXHR, textStatus, errorThrown) {
      	result.success = true ;
      	result.message = errorThrown ;
      	result.jqXHR = jqXHR ;
      	result.data = data || {} ;
    }
	};
	$.ajax(request);
	if (result.success) {
  		alert("Data loaded. TODO: populate a combo based on result.data");
  		console.log(result.data) ;
	}
</script>  -->


</head>

<body>

	<select id="mapCodes" width = "300px">
	</select>

	<div style="width: 1500px; height: 800px; margin-top: 20px;"
		id="map-canvas" />

</body>
</html>
