<html>
<head>
<!-- May need jquery to ease development - e.g. loading json doc -->
<script type="text/javascript" src="http://data.atoc.org/misc/jquery.js?v=1.4.4"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>


<script>    
     google.maps.event.addDomListener(window, 'load', function() {
         var map;
         var pathUrl = 'https://iblocks-rg-publication.s3.amazonaws.com/';
         var ctaLayer;
                  
         var setDefaultMap = function (kmlFile) {
            	ctaLayer.setUrl(pathUrl + kmlFile);
     	  }
  		
          var railStyle = [ {
              	featureType : "water",
             	 elementType : "labels",
            	  stylers : [ {
                              visibility : "off"
           		   } ]
			  }, {
           	    featureType : "transit.line",
                stylers : [ {
                              visibility : "on"
            	}, {
                              color : "#AAAAAA"
              	}, {
                              weight : 4
             	} ]
			  }, {
                featureType : "landscape",
                elementType : "geometry",
                stylers : [ {
                              visibility : "off"
             	 } ]
			  }, {
              featureType : "poi",
              elementType : "geometry",
              stylers : [ {
                              visibility : "off"
              } ]
			 }, {
              featureType : "road",
              stylers : [ {
                              visibility : "off"
              } ]
			} ];

            
        	var styledMap = new google.maps.StyledMapType(railStyle,
        		    {name: "Rail"});

        	var point = new google.maps.LatLng(51.5958, -0.11862);
        	var mapOptions = {
        	  zoom: 11,
    	      center: point,
    	      mapTypeControlOptions: {
    	          mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
	          }
	        }
           		
	        var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

	        map.mapTypes.set('map_style', styledMap);
	        map.setMapTypeId('map_style');
			
        	ctaLayer = new google.maps.KmlLayer();
    	    
		    ctaLayer.setMap(map);

		    // Create the legend and display on the map
		    var legendDiv = document.createElement('DIV');
		    var legend = new Legend(legendDiv, map);
		    legendDiv.index = 1;
		    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legendDiv);

      		$("#mapCodes").change(function(){ 
             ctaLayer.setUrl(pathUrl + $("#mapCodes option:selected").val());	
        	}); 

            $.getJSON( "ajax/map_meta_data.json?jsonp=?" );

     });

     function jsonp(data) {
         $.each(data.maps, function(key, value) {
              $("#mapCodes").append('<option value="' + value.mapUrl + '" ' + ((key == 0) ? 'selected="selected"' : '') + '>' + value.mapCode + ' - ' + value.mapName + '</option>');
              if (key == 0) { 
                  $("#mapCodes").change();
              }
         });     
 	 }

     function Legend(controlDiv, map) {
    	  // Set CSS styles for the DIV containing the control
    	  // Setting padding to 5 px will offset the control
    	  // from the edge of the map
    	  controlDiv.style.padding = '5px';

    	  // Set CSS for the control border
    	  var controlUI = document.createElement('DIV');
    	  controlUI.style.backgroundColor = 'white';
    	  controlUI.style.borderStyle = 'solid';
    	  controlUI.style.borderWidth = '1px';
    	  controlUI.title = 'Rail Map Legend';
    	  controlDiv.appendChild(controlUI);

    	  // Set CSS for the control text
    	  var controlText = document.createElement('DIV');
    	  controlText.style.fontFamily = 'Arial,sans-serif';
    	  controlText.style.fontSize = '12px';
    	  controlText.style.paddingLeft = '4px';
    	  controlText.style.paddingRight = '4px';
    	  
    	  // Add the text
    	  controlText.innerHTML = '<b>Rail Map Legend</b><br />' +
    	 		'<img src="routeing-group.gif" />  Routeing Group<br />' +
    	        '<img src="routeing-point.gif" />  Routeing Point<br />' +
    	        '<img src="interchange.gif" />  Interchange<br />';
    	  controlUI.appendChild(controlText);
     }
     </script>
</head>

<body>

	<select id="mapCodes" width = "300px">
	</select>

	<div style="width: 1200px; height: 800px; margin-top: 20px;"
		id="map-canvas" />
		
	<div id="legend">
  		<img src="interchange.gif">Interchange</img>
  	</div>

	<script></script>

</body>
</html>
